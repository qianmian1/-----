"use strict";const e=require("../../common/vendor.js"),t=require("../../common/assets.js"),o={data:()=>({title:"验证码",second:60,hi:"发送验证码",showText:!0,code:"",codeId:"",statusJson:{"-5":"验证失败","-4":"验证码已使用","-3":"验证码已失效","-2":"当前邮箱未发送验证码","-1":"还未发送验证码",0:"验证码不正确",1:"验证成功"}}),onLoad(e){this.getCode(getApp().globalData.username)},methods:{testSend(t){e.index.showLoading({mask:!0}),e.Es.callFunction({name:"emailCode",data:{method:"sendCode",email:t}}).then((t=>{e.index.hideLoading(),t.result.status?(this.codeId=t.result.id,e.index.showToast({duration:1500,icon:"none",title:"发送成功",mask:!0})):e.index.showToast({duration:1500,title:"发送失败",mask:!0,icon:"none"})})).catch((t=>{e.index.hideLoading(),e.index.showToast({title:"发送失败请重试",icon:"error"})}))},testValidate(){this.code?(e.index.showLoading({mask:!0}),e.Es.callFunction({name:"emailCode",data:{code:this.code,method:"validateCode",email:getApp().globalData.username,codeId:this.codeId,effectiveTime:300}}).then((t=>{switch(e.index.hideLoading(),t.result.status){case 1:e.index.showToast({duration:1500,title:"验证成功",mask:!0,icon:"none"}),getApp().globalData.code=!0,e.index.redirectTo({url:"/pages/login/zhuce/zhuce"});break;case 0:e.index.showToast({duration:1500,title:"验证失败，请检查验证码",mask:!0,icon:"none"});break;case-3:e.index.showToast({duration:1500,title:"验证码已失效",mask:!0,icon:"none"});break;case-4:e.index.showToast({duration:1500,title:"验证码已使用",mask:!0,icon:"none"})}})).catch((t=>{e.index.hideLoading(),e.index.showToast({title:"发送失败",icon:"error"})}))):e.index.showToast({duration:1500,title:"请输入验证码",mask:!0,icon:"none"})},getCode(e){let t=this;t.testSend(e);let o=setInterval((()=>{t.showText=!1;let e=t.second-1;t.second=e}),1e3);setTimeout((()=>{clearInterval(o),t.hi="重新发送",t.second=60,t.showText=!0}),6e4)}}};const i=e._export_sfc(o,[["render",function(o,i,a,s,n,d){return e.e({a:t._imports_0,b:t._imports_1,c:e.t(n.title),d:t._imports_2,e:n.code,f:e.o((e=>n.code=e.detail.value)),g:n.showText},n.showText?{h:e.t(n.hi),i:e.o(((...e)=>d.getCode&&d.getCode(...e)))}:{j:e.t(n.second)},{k:e.o(((...e)=>d.testValidate&&d.testValidate(...e)))})}]]);wx.createPage(i);
